# 扎金花 Flutter 游戏

## 项目愿景
- 打造体验流畅、聚焦移动端的经典扎金花（Zha Jin Hua）扑克牌游戏。  
- 首个版本以单人对抗本地 AI 为核心，后续可拓展为在线对战。  
- 提供友好的新手引导，兼顾资深玩家的快速开局需求。

## 核心玩法规则
- 使用去除大小王的标准 52 张扑克牌。  
- 每桌 2～6 名玩家，首发版本支持 1 名真人对战若干 AI。  
- 牌型大小：豹子（同花三条）> 顺金 > 顺子 > 金华（同花）> 对子 > 单牌。  
- 每局先收取底注，按顺时针进行下注回合，可在第三轮后选择看牌。  
- 玩家可发起比牌（比较需消耗筹码），比牌失败者弃牌。  
- 庄家顺时针轮换，并负责发牌与首个强制下注/底注。

## 功能需求
- **对局管理**  
  - 支持快速创建桌局，配置 AI 数量、难度与初始筹码。  
  - 提供桌面状态：当前底池、当前最高注、行动顺序、庄家标记、玩家筹码。
- **下注与操作**  
  - 实现跟注、加注、弃牌、看牌（满足条件后）、比牌等操作。  
  - 约束最小/最大加注倍数，比牌筹码由当前注额决定。  
  - 自动结算筹码、更新底池，筹码归零触发出局。
- **牌局管理**  
  - 每局重新洗牌，给每位玩家发三张暗牌，按流程逐步展示。  
  - 提供牌型评估与比较工具，覆盖所有平局判定细则。
- **AI 对手**  
  - 提供简单/普通/困难三档难度，分别采用不同下注策略（牌力评估、诈唬概率、筹码压力）。  
  - 开发模式下输出 AI 决策日志，便于调试。
- **成长与经济**  
  - 保存本地玩家资料、筹码余额，记录手数、胜率、最佳牌型等数据。  
  - 支持每日登录奖励，防止筹码耗尽后无法继续游戏。
- **用户界面**  
  - 首要优化竖屏手机布局，同时兼顾横屏/平板体验。  
  - 实现发牌、下注、摊牌等动画效果。  
  - 提供新手提示、操作引导及浮层说明。
- **音效与反馈**  
  - 内置背景音乐开关、操作音效以及支持震动的设备触感反馈。  
  - 关键事件使用弹窗/提示条进行中文反馈（例：筹码不足、操作无效）。
- **设置与多语言**  
  - 设置页包含音频、动画速度、提示开关等选项。  
  - 中文（简体）为主语言，提供英文后备文本，所有可见字符串集中管理。  
- **扩展性**  
  - 抽象网络层，便于未来加入实时联网对战。  
  - 设计可序列化的数据模型，支持本地与远程持久化。

## 非功能性要求
- 在 Android 10+ 与 iOS 14+ 的中端设备保持 60 FPS。  
- 游戏核心逻辑通过单元测试保证可预测性；随机性仅来自洗牌。  
- 模块化架构，确保游戏引擎、UI、AI 可独立测试。  
- 目标启动到进入牌桌时间低于 2 秒。  
- 纯离线运行，无需联网完成基本玩法。

## 游戏流程概览
1. 玩家选择桌局配置与 AI 难度。  
2. 进入牌桌，系统洗牌、收底注、发牌。  
3. 按顺时针进行下注直至有人弃牌、比牌或摊牌决出胜负。  
4. 赢家收取底池，轮换庄家，自动开始下一局或允许玩家退出。  
5. 退出时展示本局统计与筹码结余。

## 技术方案
- 使用 Flutter 3.x、Dart 3.x，并开启空安全。  
- 采用 Riverpod + StateNotifier 管理状态，保证逻辑可追踪。  
- 游戏引擎模块使用纯 Dart 实现牌组、下注状态机与牌型判断。  
- UI 层拆分为展示组件、基础元件与动画模块。  
- 持久化使用 `hive_flutter`，封装本地仓库统一管理玩家数据与游戏状态。  
- 音频与触感通过抽象服务层封装（例如 `just_audio`）。  
- 引入功能开关，便于在开发阶段调试不同 AI/交互行为。
- 提供区分环境的入口文件：`main_dev.dart`（开发配置）、`main_prod.dart`（生产配置）。

## 架构规划
- `lib/`  
  - `core/`：通用工具、网络封装、环境配置、主题与样式。  
  - `data/`：数据模型、Hive 仓库实现、数据源抽象层。  
  - `modules/`：业务模块（如大厅、牌桌、玩家档案等）的页面、状态与逻辑。  
  - `router/`：路由表、导航守卫与路由配置。  
  - `generated/`：自动生成文件（例：本地化、多语言、依赖注入代码），严禁手动修改。  
- 入口文件区分环境：`main_dev.dart`、`main_prod.dart`。  
- 保持清晰分层，便于测试、扩展与跨模块协作。

## UI/UX 计划
- 主菜单：快速开始、难度选择、设置、教程。  
- 牌桌界面：玩家座位、手牌展示区、筹码堆、操作按钮、状态提示。  
- 教程模式：首次启动弹出分步指引。  
- 结果弹窗：展示胜者、获胜牌型与筹码变动。  
- 个人中心：统计数据、成就及未来扩展空间。  
- 设置页：音效、语言、动画、数据重置等选项。
- 全局视觉遵循现代拟态风格（Modern Neumorphism），强调强对比阴影、柔和圆角与多层次面板，保持明暗关系一致。  
- 动画贯穿发牌、筹码移动、按钮反馈等关键交互，确保过渡流畅自然。  
- 允许使用静态图片资源与代码绘制混合方案，保证风格统一且易于维护。

## 视觉与交互风格
- 采用现代拟态风格，背景与组件使用相近色调，通过内外阴影制造层级感。  
- 阴影对比需明显，主操作区域突出，非关键区域保持柔和过渡。  
- 所有牌面、筹码等图形元素由代码生成，使用自定义绘制或矢量参数配置，保证风格统一且易于调整。  
- 引导与操作逻辑强调人性化：关键按钮始终可见，错误操作提供即时中文提示，可撤销/确认关键步骤。  
- 动画遵循“先快后慢”缓动曲线，保持界面响应迅捷，同时赋予手势与状态切换明确的动效反馈。  
- 音频资源暂缓接入，为后续音效系统预留接口与配置位。

## 开发里程碑
- 里程碑 0：项目架构搭建、依赖管理、代码规范与静态检查。  
- 里程碑 1：核心游戏引擎（牌堆、牌型评估、下注状态机）与单元测试。  
- 里程碑 2：牌桌 UI 与交互流程（玩家展示、操作按钮、筹码动画）。  
- 里程碑 3：AI 对手策略与难度调优，补充模拟测试。  
- 里程碑 4：功能打磨与发布准备（音效、本地化、教学指引、性能优化）。  
- 里程碑 5：可选增强（多人在线、详细统计、活动系统等）。

## 测试与质量保证
- 单元测试：牌堆操作、牌型判断、下注规则、AI 决策。  
- Widget 测试：关键界面布局，防止 UI 回归。  
- Golden 测试：卡牌、筹码等核心组件视觉对比。  
- 手动测试：在 Android/iOS 设备进行流程、动画、震动体验验证。  
- 集成测试（可选）：模拟完整牌局流程，确保状态机稳定。

## 项目初始化
- 安装环境：Flutter 3.x SDK、Dart 3.x、Android Studio 或 VS Code（含 Flutter 插件）。  
- 拉取依赖：`flutter pub get`。  
- 运行项目：`flutter run`。  
- 执行测试（配置完成后）：`flutter test`。  
- 静态分析（配置完成后）：`flutter analyze`。

## 注释与文本规范
- 所有代码注释、调试提示、日志输出与玩家可见的提示文本均需使用中文，并保证表述清晰、详尽。  
- 如需引用英文术语或变量名，应在中文叙述中解释其含义，确保团队成员理解一致。  
- 项目文档以中文为主，如需英文版本可另行补充，但不得影响中文信息的完整性。

## 后续行动
- 确认视觉风格规范（配色、字体、牌面素材等）。  
- 完成里程碑 0 的架构与依赖配置，为功能开发打基础。  
- 梳理美术、音效等资源需求，建立素材清单与跟踪机制。

## 资源命名规范
- 牌面图片目录：`assets/images/cards/`
- 文件命名：`{点数}{花色}.png`
- 点数：`A,K,Q,J,10,9,8,7,6,5,4,3,2`
- 花色：`S`=黑桃、`H`=红桃、`D`=方块、`C`=梅花
- 示例：`AS.png`、`10H.png`、`KC.png`

- 大小王：`BJ.png`=小王、`RJ.png`=大王
